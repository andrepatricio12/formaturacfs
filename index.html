    function carregarConvidados() {
      db.collection("convidados")
        .where("formador", "==", userMatricula)
        .get()
        .then((querySnapshot) => {
          const lista = document.getElementById("lista-convidados");
          lista.innerHTML = "";
          let contador = 0;

          querySnapshot.forEach((doc) => {
            const convidado = doc.data();
            contador += convidado.acompanhante ? 2 : 1;

            const item = document.createElement("li");
            item.className = "convidado-item";
            item.innerText = `${convidado.posto} ${convidado.nomeGuerra} ${convidado.acompanhante ? "(com acompanhante)" : ""}`;
            lista.appendChild(item);
          });

          document.getElementById("contador-convidados").innerText = contador;
        }).catch((error) => {
          console.error("Erro ao carregar convidados:", error);
        });
    }

    function gerarRelatorio() {
      db.collection("convidados")
        .get()
        .then((querySnapshot) => {
          const lista = document.getElementById("lista-relatorio");
          lista.innerHTML = "";
          const relatorio = {};

          querySnapshot.forEach((doc) => {
            const { nomeGuerra, formador } = doc.data();
            if (!relatorio[nomeGuerra]) {
              relatorio[nomeGuerra] = { count: 0, formadores: [] };
            }
            relatorio[nomeGuerra].count += 1;
            if (!relatorio[nomeGuerra].formadores.includes(formador)) {
              relatorio[nomeGuerra].formadores.push(formador);
            }
          });

          for (const [nome, data] of Object.entries(relatorio)) {
            const item = document.createElement("li");
            item.innerText = `${nome}: ${data.count} convites (${data.formadores.join(", ")})`;
            lista.appendChild(item);
          }

          document.getElementById("relatorio").style.display = "block";
        }).catch((error) => {
          console.error("Erro ao gerar relatÃ³rio:", error);
        });
    }

    function exportarCSV() {
      db.collection("convidados")
        .get()
        .then((querySnapshot) => {
          let csv = "Nome,Convites,Formadores\n";
          const relatorio = {};

          querySnapshot.forEach((doc) => {
            const { nomeGuerra, formador } = doc.data();
            if (!relatorio[nomeGuerra]) {
              relatorio[nomeGuerra] = { count: 0, formadores: [] };
            }
            relatorio[nomeGuerra].count += 1;
            if (!relatorio[nomeGuerra].formadores.includes(formador)) {
              relatorio[nomeGuerra].formadores.push(formador);
            }
          });

          for (const [nome, data] of Object.entries(relatorio)) {
            csv += `${nome},${data.count},${data.formadores.join(";")}\n`;
          }

          const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = "relatorio_convidados.csv";
          link.click();
          URL.revokeObjectURL(url);
        }).catch((error) => {
          console.error("Erro ao exportar CSV:", error);
        });
    }
  </script>
</body>
</html>
